{% extends "layout.html" %}
{% block title %} Vector Search Console {% endblock %}

{% block content %}
<style>
  pre, code.language-json {
    background: transparent !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
  /* Remove Prism.js code shadows for all tokens */
  code[class*="language-"], pre[class*="language-"] {
    text-shadow: none !important;
    box-shadow: none !important;
  }
  /* Remove background from Prism.js operator tokens */
  span.token.operator {
    background: transparent !important;
  }
</style>
<div class="container">
  <h5>Vector Search Console</h5>
  <p></p>

<form method="post" id="form" name="form" action="/vector_search_console">
  <div class="row  align-items-center">
    <div class="col-8">
      <label for="libname" class="form-label">Enter a library name or 'text:your text...'</label>
      <input type="text" class="form-control" id="libname" name="libname" value='{{ libname }}'
        placeholder="Double-click for suggestions."/> 
    </div>
    <div class="col-2">
      <span>
        <label for="search_button" class="form-label"><pre>

        </pre></label>
        <button id="search_button" name="search_button" type="submit" class="btn btn-outline-primary">Search</button>
      </span>
    </div>
  </div>
  <p class="text-danger fw-bold" id="error_message" name="error_message"></p>
</form>
</div>

<hr>

<div class="container" id="results_div" name="results_div">
  <h5>{{ results_message }}</h5>
  <pre><code class="language-json">{{ results | tojson | safe }}</code></pre>
      <!-- Prism.js for JSON syntax highlighting -->
      <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet" />
      <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sparql.min.js"></script>
</div>

<hr>

<div class="container" id="embedding_div" name="embedding_div">
  <h5>{{ embedding_message }}</h5>
  <pre>
  <code>
{{ embedding }}
  </code>
  </pre>
</div>

{% endblock %}

{% block js %}
<script>
const form = document.getElementById("form");
const search_button = document.getElementById("search_button");
const libname_form_field = document.getElementById("libname");

var suggestions_index = -1;
var suggestions = [
  "flask",
  "text: web framework async pydantic",
  "text: calculations for sports like running, cycling, and swimming",
  "text: gps file trackpoint garmin connect and garmin devices",
  "pandas"
];

libname_form_field.addEventListener('dblclick', 
    function(event) {
      suggestions_index++;
      if (suggestions_index >= suggestions.length) {
        suggestions_index = 0;
      }
      $("#libname").val(suggestions[suggestions_index]);
    }
);

search_button.addEventListener('click', 
    function(event) {
      event.preventDefault();
      search_button.disabled = true;
      search_button.textContent = "Processing...";
      form.submit();
    }
);
</script>
{% endblock %}
